import rsa_helper_functions as rsa
import datetime
import math
import statistics
from time import sleep

def avg(list_avg):
    return sum(list_avg)/len(list_avg)

def modpow(b, e, n):
	# find length of e in bits
	tst = 1
	siz = 0
	while e >= tst:
		tst <<= 1
		siz += 1
	siz -= 1
	# calculate the result
	r = 1
	for i in range(siz, -1, -1):
		r = (r * r) % n
		if (e >> i) & 1: r = (r * b) % n
	return r

def find_next_msgs(exp):
    exp = exp*2
    for i in range(100000, 109264138416697818087405225408360205259):
        val = modpow(i, exp, 109264138416697818087405225408360205259)
        val = val * i
        if (val < 109264138416697818087405225408360205259):
            val2 = modpow(i+1, exp, 109264138416697818087405225408360205259)
            val2 = val2 * (i+1)
            if (val2 > 109264138416697818087405225408360205259):
                print(str(i) + "|" + str(i+1))
                return i, i+1


p = 10756597338015291223
q = 10157871953665436333
n = p*q
keys = rsa.keysgen(p,q)
priv = keys['priv']
pub = keys['pub']

e = 302551102930460433882826511866637858843
#d = 103850030957717363945220809541239332931

exp = 1
binary_d = '1'
less_than = [4780711634765, 40522424, 16836, 7242663, 5545145, 686069, 822434, 533735, 1352774, 110356, 461916, 158819, 131833, 154773, 529115, 407660, 2341990, 508552, 149415, 103434, 190683, 184723, 452393, 205670, 343223, 158098, 136025, 316434, 216227, 129987, 282218, 146522, 341675, 500323, 210473, 2904733, 216539, 130004, 200463, 113226, 534496, 122663, 235693, 107116, 780709, 496317, 1664588, 117705, 1664435, 153518, 2679980, 1584688, 100207, 136338, 202591, 103907, 418771, 251965, 100601, 203525, 214534, 223203, 387235, 122119, 1007714, 114784, 199752, 128665, 183689, 1307040,169512,117963,500090,128429,139065,731092,264648,2066490,198525,104394,8968297,160170,1685985,274770,186675,207869,142406,260909,108197,106995,250744,1322454,204431,143680,259714,176883,103911,366093,759882,1434563,131073,278171,539668,469482,191179,342680,335248,175436,350994,178766,159109,103474]
greater_than = [4780711634965, 40522444, 16856, 7242664, 5545146, 686070, 822435, 533736, 1352775, 110357, 461917, 158820, 131834, 154774, 529116, 407661, 2341991, 508553, 149416, 103435, 190684, 184724, 452394, 205671, 343224, 158099, 136026, 316435, 216228, 129988, 282219, 146523, 341676, 500324, 210474, 2904734, 216540, 130005, 200464, 113227, 534497, 122664, 235694, 107117, 780710, 496318, 1664589, 117706, 1664436, 153519, 2679981, 1584689, 100208, 136339, 202592, 103908, 418772, 251966, 100602, 203526, 214535, 223204, 387236, 122120, 1007715, 114785, 199753, 128666, 183690, 1307041, 169513,117964,500091,128430,139066,731093,264649,2066491,198526,104395,8968298,160171,1685986,274771,186676,207870,142407,260910,108198,106996,250745,1322455,204432,143681,259715,176884,103912,366094,759883,1434564,131074,278172,539669,469483,191180,342681,335249,175437,350995,178767,159110,103475]
for i in range(len(less_than)):
    msg, msg2 = '',''
    if ( i < len(less_than) ):
        msg, msg2 = less_than[i], greater_than[i]
    else:
        msg, msg2 = find_next_msgs(exp)
    

    list_t1 = []
    list_t2 = []
    for j in range(500000):
        #dec, time1 = rsa.numdecrypt(msg, priv)
        #dec2, time2 = rsa.numdecrypt(msg2, priv)
        dec, time1 = rsa.numdecrypt_real(msg, priv)
        dec2, time2 = rsa.numdecrypt_real(msg2, priv)
        list_t1.append(time1)
        list_t2.append(time2)

    avg_1 = avg(list_t1)
    avg_2 = avg(list_t2)
    print(str(avg_1) + '|' + str(avg_2) + '|' + str(avg_2-avg_1))
    if (avg_2 - avg_1 > 0.0000005):
        binary_d += '1'
        exp = exp*2+1
    else:
        binary_d += '0'
        exp = exp*2
    print(binary_d)
